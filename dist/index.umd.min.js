/*!
 * cache-shield-sdk v1.0.4
 * (c) 2026 Suneel Kumar
 * Released under the MIT License
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).CacheShield={})}(this,function(e){"use strict";var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},t(e,r)};var r=function(){return r=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},r.apply(this,arguments)};function o(e,t,r,o){return new(r||(r=Promise))(function(n,i){function c(e){try{a(o.next(e))}catch(e){i(e)}}function s(e){try{a(o.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(c,s)}a((o=o.apply(e,t||[])).next())})}function n(e,t){var r,o,n,i={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]},c=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return c.next=s(0),c.throw=s(1),c.return=s(2),"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function s(s){return function(a){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;c&&(c=0,s[0]&&(i=0)),i;)try{if(r=1,o&&(n=2&s[0]?o.return:s[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,s[1])).done)return n;switch(o=0,n&&(s=[2&s[0],n.value]),s[0]){case 0:case 1:n=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,o=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(n=i.trys,(n=n.length>0&&n[n.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!n||s[1]>n[0]&&s[1]<n[3])){i.label=s[1];break}if(6===s[0]&&i.label<n[1]){i.label=n[1],n=s;break}if(n&&i.label<n[2]){i.label=n[2],i.ops.push(s);break}n[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],o=0}finally{r=n=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}}"function"==typeof SuppressedError&&SuppressedError;var i=function(e){function r(t,r,o,n){var i=e.call(this,t)||this;return i.code=r,i.cacheType=o,i.originalError=n,i.name="CacheShieldError",i}return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function o(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}(r,e),r}(Error),c=function(){function e(e,t){this.config=e,this.logger=t}return e.prototype.clearCacheAPI=function(){return o(this,void 0,void 0,function(){var e,t,r,o,c,s;return n(this,function(n){switch(n.label){case 0:if(!("caches"in window))return[2,{type:"cacheAPI",success:!1,error:"Cache API not supported"}];n.label=1;case 1:return n.trys.push([1,7,,8]),[4,caches.keys()];case 2:e=n.sent(),t=0,r=0,o=e,n.label=3;case 3:return r<o.length?(c=o[r],this.shouldExclude(c)?(this.logger.debug("Skipping cache: ".concat(c)),[3,5]):this.shouldInclude(c)?[4,caches.delete(c)]:[3,5]):[3,6];case 4:n.sent(),t++,this.logger.debug("Deleted cache: ".concat(c)),n.label=5;case 5:return r++,[3,3];case 6:return[2,{type:"cacheAPI",success:!0,itemsCleared:t}];case 7:throw s=n.sent(),new i("Failed to clear Cache API","UNKNOWN","cacheAPI",s instanceof Error?s:void 0);case 8:return[2]}})})},e.prototype.clearCookies=function(){return o(this,void 0,void 0,function(){var e,t,r,o,c,s,a,u,l,d,h,f,g,p;return n(this,function(n){try{for(e=this.config.cookies,t=null===(p=null==e?void 0:e.preserveEssential)||void 0===p||p,r=(null==e?void 0:e.essentialCookies)||[],o=null==e?void 0:e.names,c=null==e?void 0:e.domains,s=(null==e?void 0:e.paths)||["/"],a=this.parseCookies(),u=0,l=function(e){if(o&&o.length>0&&!o.includes(e.name))return"continue";if(t&&r.some(function(t){return e.name.toLowerCase().includes(t.toLowerCase())}))return d.logger.debug("Preserving essential cookie: ".concat(e.name)),"continue";d.deleteCookie(e.name,s,c),u++,d.logger.debug("Deleted cookie: ".concat(e.name))},d=this,h=0,f=a;h<f.length;h++)g=f[h],l(g);return[2,{type:"cookies",success:!0,itemsCleared:u}]}catch(e){throw new i("Failed to clear cookies","UNKNOWN","cookies",e instanceof Error?e:void 0)}return[2]})})},e.prototype.parseCookies=function(){return document.cookie.split(";").map(function(e){var t=e.trim().split("=");return{name:t[0],value:t[1]||""}}).filter(function(e){return e.name})},e.prototype.deleteCookie=function(e,t,r){void 0===t&&(t=["/"]);var o="Thu, 01 Jan 1970 00:00:00 GMT",n=this.config.cookies;if(null==n?void 0:n.domain)this.deleteCookieWithDomain(e,t,[n.domain],o);else{var i=r||["",window.location.hostname,"."+window.location.hostname,window.location.hostname.split(".").slice(-2).join("."),window.location.hostname.split(".").slice(-3).join(".")];this.deleteCookieWithDomain(e,t,i,o)}},e.prototype.deleteCookieWithDomain=function(e,t,r,o){for(var n=0,i=t;n<i.length;n++)for(var c=i[n],s=0,a=r;s<a.length;s++){var u=a[s];if(!u||-1!==u.indexOf(".")||"localhost"===u){var l=u?"; domain=".concat(u):"";document.cookie="".concat(e,"=; expires=").concat(o,"; path=").concat(c).concat(l),document.cookie="".concat(e,"=; expires=").concat(o,"; path=").concat(c).concat(l,"; secure")}}},e.prototype.shouldExclude=function(e){var t=this.config.exclude;return!(!t||0===t.length)&&t.some(function(t){return"string"==typeof t?e.includes(t):t.test(e)})},e.prototype.shouldInclude=function(e){var t=this.config.include;return!t||0===t.length||t.some(function(t){return"string"==typeof t?e.includes(t):t.test(e)})},e}(),s=function(){function e(e,t){this.config=e,this.logger=t}return e.prototype.clear=function(){return o(this,arguments,void 0,function(e){var t,r,o,c,s,a;return void 0===e&&(e={}),n(this,function(n){switch(n.label){case 0:if(!("serviceWorker"in navigator))return[2,{type:"serviceWorker",success:!1,error:"Service Workers not supported"}];n.label=1;case 1:return n.trys.push([1,9,,10]),[4,navigator.serviceWorker.getRegistrations()];case 2:t=n.sent(),r=0,o=0,c=t,n.label=3;case 3:return o<c.length?(s=c[o],this.shouldExclude(s.scope)?(this.logger.debug("Skipping SW: ".concat(s.scope)),[3,5]):[4,s.unregister()]):[3,6];case 4:n.sent()&&(r++,this.logger.debug("Unregistered SW: ".concat(s.scope))),n.label=5;case 5:return o++,[3,3];case 6:return e.skipCacheClear?[3,8]:[4,this.clearServiceWorkerCaches()];case 7:n.sent(),n.label=8;case 8:return[2,{type:"serviceWorker",success:!0,itemsCleared:r}];case 9:throw a=n.sent(),new i("Failed to clear Service Workers","UNKNOWN","serviceWorker",a instanceof Error?a:void 0);case 10:return[2]}})})},e.prototype.clearServiceWorkerCaches=function(){return o(this,void 0,void 0,function(){var e,t,r,o,i;return n(this,function(n){switch(n.label){case 0:return"caches"in window?[4,caches.keys()]:[2,0];case 1:e=n.sent(),t=0,r=0,o=e,n.label=2;case 2:return r<o.length?(i=o[r],this.shouldExclude(i)?[3,4]:[4,caches.delete(i)]):[3,5];case 3:n.sent(),t++,this.logger.debug("Deleted cache: ".concat(i)),n.label=4;case 4:return r++,[3,2];case 5:return[2,t]}})})},e.prototype.shouldExclude=function(e){var t=this.config.exclude;return!(!t||0===t.length)&&t.some(function(t){return"string"==typeof t?e.includes(t):t.test(e)})},e.prototype.update=function(){return o(this,void 0,void 0,function(){var e,t;return n(this,function(r){switch(r.label){case 0:if(!("serviceWorker"in navigator))return[2,!1];r.label=1;case 1:return r.trys.push([1,5,,6]),[4,navigator.serviceWorker.getRegistration()];case 2:return(null==(e=r.sent())?void 0:e.waiting)?(e.waiting.postMessage({type:"SKIP_WAITING"}),[2,!0]):e?[4,e.update()]:[3,4];case 3:return r.sent(),[2,!0];case 4:return[2,!1];case 5:return t=r.sent(),this.logger.error("Failed to update Service Worker",t),[2,!1];case 6:return[2]}})})},e}(),a=function(){function e(e,t){this.config=e,this.logger=t}return e.prototype.clearLocalStorage=function(){return o(this,void 0,void 0,function(){return n(this,function(e){return[2,this.clearStorage("localStorage",localStorage)]})})},e.prototype.clearSessionStorage=function(){return o(this,void 0,void 0,function(){return n(this,function(e){return[2,this.clearStorage("sessionStorage",sessionStorage)]})})},e.prototype.clearStorage=function(e,t){return o(this,void 0,void 0,function(){var r,o,c,s,a,u,l,d,h,f,g,p,v,y;return n(this,function(n){try{for(r=this.config.storage,o=(null==r?void 0:r.preserveKeys)||[],c=null==r?void 0:r.preservePattern,s=null==r?void 0:r.keyPattern,a=[],u=[],l=0;l<t.length;l++)(y=t.key(l))&&(o.includes(y)||c&&c.test(y)?u.push(y):s&&!s.test(y)||a.push(y));for(d=0,h=0,f=a;h<f.length;h++)y=f[h],(g=t.getItem(y))&&(d+=y.length+g.length);for(d*=2,p=0,v=a;p<v.length;p++)y=v[p],t.removeItem(y),this.logger.debug("Removed ".concat(e," key: ").concat(y));return this.logger.info("".concat(e," cleared"),{removed:a.length,preserved:u.length}),[2,{type:e,success:!0,itemsCleared:a.length,bytesFreed:d}]}catch(t){throw new i("Failed to clear ".concat(e),"UNKNOWN",e,t instanceof Error?t:void 0)}return[2]})})},e.prototype.getStorageStats=function(){return{localStorage:this.calculateStorageSize(localStorage),sessionStorage:this.calculateStorageSize(sessionStorage)}},e.prototype.calculateStorageSize=function(e){for(var t=0,r=0;r<e.length;r++){var o=e.key(r);if(o){var n=e.getItem(o)||"";t+=2*(o.length+n.length)}}return t},e}(),u=function(){function e(e,t){this.config=e,this.logger=t}return e.prototype.clear=function(){return o(this,void 0,void 0,function(){var e,t,r,o,c,s,a,u,l,d,h;return n(this,function(n){switch(n.label){case 0:if(!("indexedDB"in window))return[2,{type:"indexedDB",success:!1,error:"IndexedDB not supported"}];n.label=1;case 1:return n.trys.push([1,10,,11]),[4,this.getDatabases()];case 2:e=n.sent(),t=this.config.indexedDB,r=null==t?void 0:t.databases,o=null===(h=null==t?void 0:t.deleteDatabase)||void 0===h||h,c=0,s=0,a=e,n.label=3;case 3:return s<a.length?(u=a[s],(l=u.name)?r&&r.length>0&&!r.includes(l)?[3,8]:this.shouldExclude(l)?(this.logger.debug("Skipping IndexedDB: ".concat(l)),[3,8]):o?[4,this.deleteDatabase(l)]:[3,5]:[3,8]):[3,9];case 4:return n.sent(),[3,7];case 5:return[4,this.clearDatabaseData(l)];case 6:n.sent(),n.label=7;case 7:c++,this.logger.debug("Cleared IndexedDB: ".concat(l)),n.label=8;case 8:return s++,[3,3];case 9:return[2,{type:"indexedDB",success:!0,itemsCleared:c}];case 10:throw d=n.sent(),new i("Failed to clear IndexedDB","UNKNOWN","indexedDB",d instanceof Error?d:void 0);case 11:return[2]}})})},e.prototype.getDatabases=function(){return o(this,void 0,void 0,function(){return n(this,function(e){return"databases"in indexedDB?[2,indexedDB.databases()]:(this.logger.warn("indexedDB.databases() not supported"),[2,[]])})})},e.prototype.deleteDatabase=function(e){var t=this;return new Promise(function(r,o){var n=indexedDB.deleteDatabase(e);n.onsuccess=function(){t.logger.debug("Deleted database: ".concat(e)),r()},n.onerror=function(){o(new Error("Failed to delete database: ".concat(e)))},n.onblocked=function(){t.logger.warn("Database deletion blocked: ".concat(e)),o(new Error("Database deletion blocked (open in another tab): ".concat(e)))}})},e.prototype.clearDatabaseData=function(e){return o(this,void 0,void 0,function(){var t=this;return n(this,function(r){return[2,new Promise(function(r,i){var c=indexedDB.open(e);c.onsuccess=function(){return o(t,void 0,void 0,function(){var t,o,s,a,u,l;return n(this,function(n){if(t=c.result,0===(o=Array.from(t.objectStoreNames)).length)return t.close(),r(),[2];for(s=t.transaction(o,"readwrite"),a=0,u=o;a<u.length;a++)l=u[a],s.objectStore(l).clear();return s.oncomplete=function(){t.close(),r()},s.onerror=function(){t.close(),i(new Error("Failed to clear data in: ".concat(e)))},[2]})})},c.onerror=function(){i(new Error("Failed to open database: ".concat(e)))}})]})})},e.prototype.shouldExclude=function(e){var t=this.config.exclude;return!(!t||0===t.length)&&t.some(function(t){return"string"==typeof t?e.includes(t):t.test(e)})},e}(),l=function(){function e(e){this.logger=e}return e.prototype.reload=function(e){void 0===e&&(e=!0),e?this.performCacheBustedReload():(this.logger.debug("Performing standard reload"),window.location.reload())},e.prototype.performCacheBustedReload=function(){this.logger.debug("Performing smart cache-busting reload");try{var e=new URL(window.location.href);e.searchParams.set("_cs_bust",Date.now().toString()),window.location.replace(e.toString())}catch(e){this.logger.warn("Smart reload failed, falling back to standard reload",e),window.location.reload()}},e}(),d=function(){function e(e){this.logger=e,this.initialized=!1}return e.prototype.init=function(){var e=this;this.initialized||"undefined"==typeof window||(window.addEventListener("pageshow",function(t){t.persisted&&(e.logger.info("Page restored from bfcache detected, forcing reload to ensure freshness"),window.location.reload())}),this.initialized=!0,this.logger.debug("BfCache protection initialized"))},e}(),h=function(){function e(e){void 0===e&&(e=!1),this.enabled=e,this.prefix="[CacheShield]"}return e.prototype.debug=function(e,t){this.log("debug",e,t)},e.prototype.info=function(e,t){this.log("info",e,t)},e.prototype.warn=function(e,t){this.log("warn",e,t)},e.prototype.error=function(e,t){this.log("error",e,t)},e.prototype.success=function(e,t){this.log("success",e,t)},e.prototype.log=function(e,t,r){if(this.enabled||"debug"!==e)if("undefined"!=typeof window&&"undefined"!=typeof document){console["error"===e?"error":"warn"===e?"warn":"log"]("%c".concat({debug:"ðŸ”",info:"â„¹ï¸",warn:"âš ï¸",error:"âŒ",success:"âœ…"}[e]," ").concat(this.prefix," ").concat(t),{debug:"color: #888",info:"color: #2196F3",warn:"color: #FF9800",error:"color: #F44336",success:"color: #4CAF50"}[e],void 0!==r?r:"")}else{console["error"===e?"error":"warn"===e?"warn":"log"]("[".concat(e.toUpperCase(),"] ").concat(this.prefix," ").concat(t),void 0!==r?r:"")}},e}();function f(){return{serviceWorker:"serviceWorker"in navigator,cacheAPI:"caches"in window,indexedDB:"indexedDB"in window,localStorage:g("localStorage"),sessionStorage:g("sessionStorage"),cookies:navigator.cookieEnabled,storageEstimate:"storage"in navigator&&"estimate"in navigator.storage,persistentStorage:"storage"in navigator&&"persist"in navigator.storage}}function g(e){try{var t=window[e],r="__cache_shield_test__";return t.setItem(r,"test"),t.removeItem(r),!0}catch(e){return!1}}function p(){return"undefined"!=typeof window&&"undefined"!=typeof document}var v=function(){function e(e){void 0===e&&(e={}),this.config=this.mergeConfig(e),this.logger=new h(this.config.debug),this.capabilities=f(),this.browserCache=new c(this.config,this.logger),this.serviceWorker=new s(this.config,this.logger),this.storage=new a(this.config,this.logger),this.indexedDB=new u(this.config,this.logger),this.reloader=new l(this.logger),this.bfCache=new d(this.logger),this.config.preventBfCache&&this.bfCache.init(),this.logger.info("CacheShield initialized",{config:this.config,capabilities:this.capabilities})}return e.prototype.clear=function(e){return o(this,void 0,void 0,function(){var t,o,i,c,s,a,u,l,d,h,f,g,p,v,y,w,b,k,m,S,C,D,x,E,B,W=this;return n(this,function(n){switch(n.label){case 0:t=performance.now(),o=e?this.mergeConfig(r(r({},this.config),e)):this.config,i=this.resolveTargets(o.targets),this.logger.info("Starting cache clear",{targets:i}),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,null===(m=(k=o.hooks).onBeforeClear)||void 0===m?void 0:m.call(k,i)];case 2:return n.sent(),[3,4];case 3:return c=n.sent(),this.logger.error("onBeforeClear hook failed",c),[3,4];case 4:s=[],a=i.length,u=0,l=i.includes("cacheAPI"),d=0,h=i,n.label=5;case 5:if(!(d<h.length))return[3,11];f=h[d],n.label=6;case 6:return n.trys.push([6,8,,9]),[4,this.clearCacheType(f,{skipCacheClear:"serviceWorker"===f&&l})];case 7:return g=n.sent(),s.push(g),g.success?this.logger.success("Cleared ".concat(f),g):this.logger.warn("Failed to clear ".concat(f),g),[3,9];case 8:p=n.sent(),v=this.wrapError(p,f);try{null===(C=(S=o.hooks).onError)||void 0===C||C.call(S,v)}catch(e){this.logger.error("onError hook failed",e)}return s.push({type:f,success:!1,error:v.message}),[3,9];case 9:u++;try{null===(x=(D=o.hooks).onProgress)||void 0===x||x.call(D,{current:f,completed:u,total:a,percentage:Math.round(u/a*100)})}catch(e){this.logger.error("onProgress hook failed",e)}n.label=10;case 10:return d++,[3,5];case 11:y=performance.now()-t,w={success:s.every(function(e){return e.success}),cleared:s.filter(function(e){return e.success}),failed:s.filter(function(e){return!e.success}),timestamp:Date.now(),duration:y},this.logger.info("Cache clear completed",w),n.label=12;case 12:return n.trys.push([12,14,,15]),[4,null===(B=(E=o.hooks).onAfterClear)||void 0===B?void 0:B.call(E,w)];case 13:return n.sent(),[3,15];case 14:return b=n.sent(),this.logger.error("onAfterClear hook failed",b),[3,15];case 15:return o.autoReload&&w.success&&setTimeout(function(){W.reloader.reload(!0)},o.reloadDelay),[2,w]}})})},e.prototype.clearCacheType=function(e){return o(this,arguments,void 0,function(e,t){return void 0===t&&(t={}),n(this,function(r){switch(e){case"serviceWorker":return[2,this.serviceWorker.clear(t)];case"cacheAPI":return[2,this.browserCache.clearCacheAPI()];case"localStorage":return[2,this.storage.clearLocalStorage()];case"sessionStorage":return[2,this.storage.clearSessionStorage()];case"indexedDB":return[2,this.indexedDB.clear()];case"cookies":return[2,this.browserCache.clearCookies()];default:return[2,{type:e,success:!1,error:"Unknown cache type: ".concat(e)}]}})})},e.prototype.clearServiceWorkers=function(){return o(this,void 0,void 0,function(){return n(this,function(e){return[2,this.serviceWorker.clear()]})})},e.prototype.clearCacheAPI=function(){return o(this,void 0,void 0,function(){return n(this,function(e){return[2,this.browserCache.clearCacheAPI()]})})},e.prototype.clearLocalStorage=function(){return o(this,void 0,void 0,function(){return n(this,function(e){return[2,this.storage.clearLocalStorage()]})})},e.prototype.clearSessionStorage=function(){return o(this,void 0,void 0,function(){return n(this,function(e){return[2,this.storage.clearSessionStorage()]})})},e.prototype.clearIndexedDB=function(){return o(this,void 0,void 0,function(){return n(this,function(e){return[2,this.indexedDB.clear()]})})},e.prototype.clearCookies=function(){return o(this,void 0,void 0,function(){return n(this,function(e){return[2,this.browserCache.clearCookies()]})})},e.prototype.hardReload=function(){this.reloader.reload(!0)},e.prototype.clearAndReload=function(e){return o(this,void 0,void 0,function(){return n(this,function(t){switch(t.label){case 0:return[4,this.clear(e)];case 1:return t.sent(),this.hardReload(),[2]}})})},e.prototype.getStorageEstimate=function(){return o(this,void 0,void 0,function(){return n(this,function(e){return"storage"in navigator&&"estimate"in navigator.storage?[2,navigator.storage.estimate()]:[2,null]})})},e.prototype.getCapabilities=function(){return this.capabilities},e.prototype.resolveTargets=function(e){var t=this;if(e.includes("all")){return["serviceWorker","cacheAPI","localStorage","sessionStorage","indexedDB","cookies"].filter(function(e){switch(e){case"serviceWorker":return t.capabilities.serviceWorker;case"cacheAPI":return t.capabilities.cacheAPI;case"indexedDB":return t.capabilities.indexedDB;default:return!0}})}return e},e.prototype.mergeConfig=function(t){return r(r(r({},e.DEFAULTS),t),{cookies:r(r({},e.DEFAULTS.cookies),t.cookies),indexedDB:r(r({},e.DEFAULTS.indexedDB),t.indexedDB),storage:r(r({},e.DEFAULTS.storage),t.storage),hooks:r(r({},e.DEFAULTS.hooks),t.hooks)})},e.prototype.wrapError=function(e,t){if(e instanceof i)return e;var r=e instanceof Error?e:new Error(String(e));return new i("Failed to clear ".concat(t,": ").concat(r.message),"UNKNOWN",t,r)},e.DEFAULTS={targets:["all"],include:[],exclude:[],cookies:{preserveEssential:!0,essentialCookies:["csrf","session","auth"]},indexedDB:{deleteDatabase:!0},storage:{preserveKeys:[]},debug:!1,hooks:{},autoReload:!1,reloadDelay:100,preventBfCache:!1},e}();var y=null;e.CacheShield=v,e.CacheShieldError=i,e.clearCache=function(e){return o(this,void 0,void 0,function(){return n(this,function(t){return[2,new v(e).clear()]})})},e.default=v,e.detectCapabilities=f,e.getCacheShield=function(e){return y||(y=new v(e)),y},e.isBrowser=p,e.isSecureContext=function(){return p()&&window.isSecureContext},Object.defineProperty(e,"__esModule",{value:!0})});
