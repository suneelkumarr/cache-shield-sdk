import{ref as e,reactive as t,readonly as r,inject as n}from"vue";var o=function(e,t){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},o(e,t)};var i=function(){return i=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},i.apply(this,arguments)};function a(e,t,r,n){return new(r||(r=Promise))(function(o,i){function a(e){try{c(n.next(e))}catch(e){i(e)}}function s(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(a,s)}c((n=n.apply(e,t||[])).next())})}function s(e,t){var r,n,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=s(0),a.throw=s(1),a.return=s(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(r=1,n&&(o=2&s[0]?n.return:s[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,s[1])).done)return o;switch(n=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,n=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],n=0}finally{r=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}}function c(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function l(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(e){o={error:e}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return a}"function"==typeof SuppressedError&&SuppressedError;var u=function(e){function t(t,r,n,o){var i=e.call(this,t)||this;return i.code=r,i.cacheType=n,i.originalError=o,i.name="CacheShieldError",i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}(t,e),t}(Error),d=function(){function e(e,t){this.config=e,this.logger=t}return e.prototype.clearCacheAPI=function(){return a(this,void 0,void 0,function(){var e,t,r,n,o,i,a,l,d;return s(this,function(s){switch(s.label){case 0:if(!("caches"in window))return[2,{type:"cacheAPI",success:!1,error:"Cache API not supported"}];s.label=1;case 1:return s.trys.push([1,11,,12]),[4,caches.keys()];case 2:e=s.sent(),t=0,s.label=3;case 3:s.trys.push([3,8,9,10]),r=c(e),n=r.next(),s.label=4;case 4:return n.done?[3,7]:(o=n.value,this.shouldExclude(o)?(this.logger.debug("Skipping cache: ".concat(o)),[3,6]):this.shouldInclude(o)?[4,caches.delete(o)]:[3,6]);case 5:s.sent(),t++,this.logger.debug("Deleted cache: ".concat(o)),s.label=6;case 6:return n=r.next(),[3,4];case 7:return[3,10];case 8:return i=s.sent(),l={error:i},[3,10];case 9:try{n&&!n.done&&(d=r.return)&&d.call(r)}finally{if(l)throw l.error}return[7];case 10:return[2,{type:"cacheAPI",success:!0,itemsCleared:t}];case 11:throw a=s.sent(),new u("Failed to clear Cache API","UNKNOWN","cacheAPI",a instanceof Error?a:void 0);case 12:return[2]}})})},e.prototype.clearCookies=function(){return a(this,void 0,void 0,function(){var e,t,r,n,o,i,a,l,d,h,f,g,p,v,y,b;return s(this,function(s){try{e=this.config.cookies,t=null===(b=null==e?void 0:e.preserveEssential)||void 0===b||b,r=(null==e?void 0:e.essentialCookies)||[],n=null==e?void 0:e.names,o=null==e?void 0:e.domains,i=(null==e?void 0:e.paths)||["/"],a=this.parseCookies(),l=0,d=function(e){if(n&&n.length>0&&!n.includes(e.name))return"continue";if(t&&r.some(function(t){return e.name.toLowerCase().includes(t.toLowerCase())}))return h.logger.debug("Preserving essential cookie: ".concat(e.name)),"continue";h.deleteCookie(e.name,i,o),l++,h.logger.debug("Deleted cookie: ".concat(e.name))},h=this;try{for(f=c(a),g=f.next();!g.done;g=f.next())p=g.value,d(p)}catch(e){v={error:e}}finally{try{g&&!g.done&&(y=f.return)&&y.call(f)}finally{if(v)throw v.error}}return[2,{type:"cookies",success:!0,itemsCleared:l}]}catch(e){throw new u("Failed to clear cookies","UNKNOWN","cookies",e instanceof Error?e:void 0)}return[2]})})},e.prototype.parseCookies=function(){return document.cookie.split(";").map(function(e){var t=l(e.trim().split("="),2);return{name:t[0],value:t[1]||""}}).filter(function(e){return e.name})},e.prototype.deleteCookie=function(e,t,r){void 0===t&&(t=["/"]);var n="Thu, 01 Jan 1970 00:00:00 GMT",o=this.config.cookies;if(null==o?void 0:o.domain)this.deleteCookieWithDomain(e,t,[o.domain],n);else{var i=r||this.getDomainsToTry();this.deleteCookieWithDomain(e,t,i,n)}},e.prototype.getDomainsToTry=function(){var e=window.location.hostname,t=e.split("."),r=[""];if(e&&(r.push(e),r.push("."+e)),t.length>=2){var n=t.slice(-2).join(".");n!==e&&(r.push(n),r.push("."+n))}if(t.length>=3){var o=t.slice(-3).join(".");o!==e&&!r.includes(o)&&o.split(".").length>=2&&(r.push(o),r.push("."+o))}return function(e,t,r){if(r||2===arguments.length)for(var n,o=0,i=t.length;o<i;o++)!n&&o in t||(n||(n=Array.prototype.slice.call(t,0,o)),n[o]=t[o]);return e.concat(n||Array.prototype.slice.call(t))}([],l(new Set(r)),!1).filter(function(e){return""===e||"localhost"===e||/^\.?[a-zA-Z0-9][-a-zA-Z0-9]*(\.[a-zA-Z0-9][-a-zA-Z0-9]*)+$/.test(e)})},e.prototype.deleteCookieWithDomain=function(e,t,r,n){var o,i,a,s;try{for(var l=c(t),u=l.next();!u.done;u=l.next()){var d=u.value;try{for(var h=(a=void 0,c(r)),f=h.next();!f.done;f=h.next()){var g=f.value;if(!g||-1!==g.indexOf(".")||"localhost"===g){var p=g?"; domain=".concat(g):"";document.cookie="".concat(e,"=; expires=").concat(n,"; path=").concat(d).concat(p),document.cookie="".concat(e,"=; expires=").concat(n,"; path=").concat(d).concat(p,"; secure"),this.logger.debug('Attempted to delete cookie "'.concat(e,'"'),{domain:g||"(current)",path:d,timestamp:(new Date).toISOString()})}}}catch(e){a={error:e}}finally{try{f&&!f.done&&(s=h.return)&&s.call(h)}finally{if(a)throw a.error}}}}catch(e){o={error:e}}finally{try{u&&!u.done&&(i=l.return)&&i.call(l)}finally{if(o)throw o.error}}},e.prototype.shouldExclude=function(e){var t=this.config.exclude;return!(!t||0===t.length)&&t.some(function(t){return"string"==typeof t?e.includes(t):t.test(e)})},e.prototype.shouldInclude=function(e){var t=this.config.include;return!t||0===t.length||t.some(function(t){return"string"==typeof t?e.includes(t):t.test(e)})},e}(),h=function(){function e(e,t){this.config=e,this.logger=t}return e.prototype.clear=function(){return a(this,arguments,void 0,function(e){var t,r,n,o,i,a,l,d,h;return void 0===e&&(e={}),s(this,function(s){switch(s.label){case 0:if(!("serviceWorker"in navigator))return[2,{type:"serviceWorker",success:!1,error:"Service Workers not supported"}];s.label=1;case 1:return s.trys.push([1,13,,14]),[4,navigator.serviceWorker.getRegistrations()];case 2:t=s.sent(),r=0,s.label=3;case 3:s.trys.push([3,8,9,10]),n=c(t),o=n.next(),s.label=4;case 4:return o.done?[3,7]:(i=o.value,this.shouldExclude(i.scope)?(this.logger.debug("Skipping SW: ".concat(i.scope)),[3,6]):[4,i.unregister()]);case 5:s.sent()&&(r++,this.logger.debug("Unregistered SW: ".concat(i.scope))),s.label=6;case 6:return o=n.next(),[3,4];case 7:return[3,10];case 8:return a=s.sent(),d={error:a},[3,10];case 9:try{o&&!o.done&&(h=n.return)&&h.call(n)}finally{if(d)throw d.error}return[7];case 10:return e.skipCacheClear?[3,12]:[4,this.clearServiceWorkerCaches()];case 11:s.sent(),s.label=12;case 12:return[2,{type:"serviceWorker",success:!0,itemsCleared:r}];case 13:throw l=s.sent(),new u("Failed to clear Service Workers","UNKNOWN","serviceWorker",l instanceof Error?l:void 0);case 14:return[2]}})})},e.prototype.clearServiceWorkerCaches=function(){return a(this,void 0,void 0,function(){var e,t,r,n,o,i,a,l;return s(this,function(s){switch(s.label){case 0:return"caches"in window?[4,caches.keys()]:[2,0];case 1:e=s.sent(),t=0,s.label=2;case 2:s.trys.push([2,7,8,9]),r=c(e),n=r.next(),s.label=3;case 3:return n.done?[3,6]:(o=n.value,this.shouldExclude(o)?[3,5]:[4,caches.delete(o)]);case 4:s.sent(),t++,this.logger.debug("Deleted cache: ".concat(o)),s.label=5;case 5:return n=r.next(),[3,3];case 6:return[3,9];case 7:return i=s.sent(),a={error:i},[3,9];case 8:try{n&&!n.done&&(l=r.return)&&l.call(r)}finally{if(a)throw a.error}return[7];case 9:return[2,t]}})})},e.prototype.shouldExclude=function(e){var t=this.config.exclude;return!(!t||0===t.length)&&t.some(function(t){return"string"==typeof t?e.includes(t):t.test(e)})},e.prototype.update=function(){return a(this,void 0,void 0,function(){var e,t;return s(this,function(r){switch(r.label){case 0:if(!("serviceWorker"in navigator))return[2,!1];r.label=1;case 1:return r.trys.push([1,5,,6]),[4,navigator.serviceWorker.getRegistration()];case 2:return(null==(e=r.sent())?void 0:e.waiting)?(e.waiting.postMessage({type:"SKIP_WAITING"}),[2,!0]):e?[4,e.update()]:[3,4];case 3:return r.sent(),[2,!0];case 4:return[2,!1];case 5:return t=r.sent(),this.logger.error("Failed to update Service Worker",t),[2,!1];case 6:return[2]}})})},e}(),f=function(){function e(e,t){this.config=e,this.logger=t}return e.prototype.clearLocalStorage=function(){return a(this,void 0,void 0,function(){return s(this,function(e){return[2,this.clearStorage("localStorage",localStorage)]})})},e.prototype.clearSessionStorage=function(){return a(this,void 0,void 0,function(){return s(this,function(e){return[2,this.clearStorage("sessionStorage",sessionStorage)]})})},e.prototype.clearStorage=function(e,t){return a(this,void 0,void 0,function(){var r,n,o,i,a,l,d,h,f,g,p,v,y,b,w,m,S,k;return s(this,function(s){try{for(r=this.config.storage,n=(null==r?void 0:r.preserveKeys)||[],o=null==r?void 0:r.preservePattern,i=null==r?void 0:r.keyPattern,a=[],l=[],d=0;d<t.length;d++)(b=t.key(d))&&(n.includes(b)||o&&o.test(b)?l.push(b):i&&!i.test(b)||a.push(b));h=0;try{for(f=c(a),g=f.next();!g.done;g=f.next())b=g.value,(p=t.getItem(b))&&(h+=b.length+p.length)}catch(e){w={error:e}}finally{try{g&&!g.done&&(m=f.return)&&m.call(f)}finally{if(w)throw w.error}}h*=2;try{for(v=c(a),y=v.next();!y.done;y=v.next())b=y.value,t.removeItem(b),this.logger.debug("Removed ".concat(e," key: ").concat(b))}catch(e){S={error:e}}finally{try{y&&!y.done&&(k=v.return)&&k.call(v)}finally{if(S)throw S.error}}return this.logger.info("".concat(e," cleared"),{removed:a.length,preserved:l.length}),[2,{type:e,success:!0,itemsCleared:a.length,bytesFreed:h}]}catch(t){throw new u("Failed to clear ".concat(e),"UNKNOWN",e,t instanceof Error?t:void 0)}return[2]})})},e.prototype.getStorageStats=function(){return{localStorage:this.calculateStorageSize(localStorage),sessionStorage:this.calculateStorageSize(sessionStorage)}},e.prototype.calculateStorageSize=function(e){for(var t=0,r=0;r<e.length;r++){var n=e.key(r);if(n){var o=e.getItem(n)||"";t+=2*(n.length+o.length)}}return t},e}(),g=function(){function e(e,t){this.config=e,this.logger=t}return e.prototype.clear=function(){return a(this,void 0,void 0,function(){var e,t,r,n,o,i,a,l,d,h,f,g,p,v;return s(this,function(s){switch(s.label){case 0:if(!("indexedDB"in window))return[2,{type:"indexedDB",success:!1,error:"IndexedDB not supported"}];s.label=1;case 1:return s.trys.push([1,14,,15]),[4,this.getDatabases()];case 2:e=s.sent(),t=this.config.indexedDB,r=null==t?void 0:t.databases,n=null===(v=null==t?void 0:t.deleteDatabase)||void 0===v||v,o=0,s.label=3;case 3:s.trys.push([3,11,12,13]),i=c(e),a=i.next(),s.label=4;case 4:return a.done?[3,10]:(l=a.value,(d=l.name)?r&&r.length>0&&!r.includes(d)?[3,9]:this.shouldExclude(d)?(this.logger.debug("Skipping IndexedDB: ".concat(d)),[3,9]):n?[4,this.deleteDatabase(d)]:[3,6]:[3,9]);case 5:return s.sent(),[3,8];case 6:return[4,this.clearDatabaseData(d)];case 7:s.sent(),s.label=8;case 8:o++,this.logger.debug("Cleared IndexedDB: ".concat(d)),s.label=9;case 9:return a=i.next(),[3,4];case 10:return[3,13];case 11:return h=s.sent(),g={error:h},[3,13];case 12:try{a&&!a.done&&(p=i.return)&&p.call(i)}finally{if(g)throw g.error}return[7];case 13:return[2,{type:"indexedDB",success:!0,itemsCleared:o}];case 14:throw f=s.sent(),new u("Failed to clear IndexedDB","UNKNOWN","indexedDB",f instanceof Error?f:void 0);case 15:return[2]}})})},e.prototype.getDatabases=function(){return a(this,void 0,void 0,function(){var e;return s(this,function(t){switch(t.label){case 0:if(!("databases"in indexedDB))return[3,4];t.label=1;case 1:return t.trys.push([1,3,,4]),[4,indexedDB.databases()];case 2:return[2,t.sent()];case 3:return e=t.sent(),this.logger.warn("indexedDB.databases() failed",e),[2,this.getFallbackDatabases()];case 4:return[2,this.getFallbackDatabases()]}})})},e.prototype.getFallbackDatabases=function(){return a(this,void 0,void 0,function(){var e,t,r,n,o,i,a,l,u,d;return s(this,function(s){switch(s.label){case 0:if((e=(null===(d=this.config.indexedDB)||void 0===d?void 0:d.databases)||[]).length>0)return this.logger.debug("Using configured database names",e),[2,e.map(function(e){return{name:e}})];t=["firebaseLocalStorageDb","_ionicstorage","reactnative","redux-persist","localforage","ngsw:cache:v1","vuex-persist","pouchdb","__zone_symbol__Promise","default"],r=[],s.label=1;case 1:s.trys.push([1,8,9,10]),n=c(t),o=n.next(),s.label=2;case 2:if(o.done)return[3,7];i=o.value,s.label=3;case 3:return s.trys.push([3,5,,6]),[4,this.testDatabaseExists(i)];case 4:return s.sent()&&r.push({name:i}),[3,6];case 5:return s.sent(),[3,6];case 6:return o=n.next(),[3,2];case 7:return[3,10];case 8:return a=s.sent(),l={error:a},[3,10];case 9:try{o&&!o.done&&(u=n.return)&&u.call(n)}finally{if(l)throw l.error}return[7];case 10:return 0===r.length&&this.logger.warn("No IndexedDB databases found. Specify databases in config for Safari/older browsers.",{example:'indexedDB: { databases: ["my-db"] }'}),[2,r]}})})},e.prototype.testDatabaseExists=function(e){return new Promise(function(t){try{var r=indexedDB.open(e),n=!1;r.onsuccess=function(){var e=r.result;n=e.objectStoreNames.length>0,e.close(),t(n)},r.onerror=function(){t(!1)},r.onupgradeneeded=function(){r.result.close(),t(!1)},setTimeout(function(){!n&&r.result&&(r.result.close(),t(n))},1e3)}catch(e){t(!1)}})},e.prototype.deleteDatabase=function(e){var t=this;return new Promise(function(r,n){var o=indexedDB.deleteDatabase(e);o.onsuccess=function(){t.logger.debug("Deleted database: ".concat(e)),r()},o.onerror=function(){n(new Error("Failed to delete database: ".concat(e)))},o.onblocked=function(){t.logger.warn("Database deletion blocked: ".concat(e)),n(new Error("Database deletion blocked (open in another tab): ".concat(e)))}})},e.prototype.clearDatabaseData=function(e){return a(this,void 0,void 0,function(){var t=this;return s(this,function(r){return[2,new Promise(function(r,n){var o=indexedDB.open(e);o.onsuccess=function(){return a(t,void 0,void 0,function(){var t,i,a,l,u,d,h,f;return s(this,function(s){if(t=o.result,0===(i=Array.from(t.objectStoreNames)).length)return t.close(),r(),[2];a=t.transaction(i,"readwrite");try{for(l=c(i),u=l.next();!u.done;u=l.next())d=u.value,a.objectStore(d).clear()}catch(e){h={error:e}}finally{try{u&&!u.done&&(f=l.return)&&f.call(l)}finally{if(h)throw h.error}}return a.oncomplete=function(){t.close(),r()},a.onerror=function(){t.close(),n(new Error("Failed to clear data in: ".concat(e)))},[2]})})},o.onerror=function(){n(new Error("Failed to open database: ".concat(e)))}})]})})},e.prototype.shouldExclude=function(e){var t=this.config.exclude;return!(!t||0===t.length)&&t.some(function(t){return"string"==typeof t?e.includes(t):t.test(e)})},e}(),p=function(){function e(e){this.logger=e}return e.prototype.reload=function(e){void 0===e&&(e=!0),e?this.performCacheBustedReload():(this.logger.debug("Performing standard reload"),window.location.reload())},e.prototype.performCacheBustedReload=function(){this.logger.debug("Performing smart cache-busting reload");try{var e=new URL(window.location.href);e.searchParams.set("_cs_bust",Date.now().toString()),window.location.replace(e.toString())}catch(e){this.logger.warn("Smart reload failed, falling back to standard reload",e),window.location.reload()}},e}(),v=function(){function e(e){this.logger=e,this.initialized=!1}return e.prototype.init=function(){var e=this;this.initialized||"undefined"==typeof window||(window.addEventListener("pageshow",function(t){t.persisted&&(e.logger.info("Page restored from bfcache detected, forcing reload to ensure freshness"),window.location.reload())}),this.initialized=!0,this.logger.debug("BfCache protection initialized"))},e}(),y=function(){function e(e){void 0===e&&(e=!1),this.enabled=e,this.prefix="[CacheShield]"}return e.prototype.debug=function(e,t){this.log("debug",e,t)},e.prototype.info=function(e,t){this.log("info",e,t)},e.prototype.warn=function(e,t){this.log("warn",e,t)},e.prototype.error=function(e,t){this.log("error",e,t)},e.prototype.success=function(e,t){this.log("success",e,t)},e.prototype.log=function(e,t,r){if(this.enabled||"debug"!==e)if("undefined"!=typeof window&&"undefined"!=typeof document){console["error"===e?"error":"warn"===e?"warn":"log"]("%c".concat({debug:"üîç",info:"‚ÑπÔ∏è",warn:"‚ö†Ô∏è",error:"‚ùå",success:"‚úÖ"}[e]," ").concat(this.prefix," ").concat(t),{debug:"color: #888",info:"color: #2196F3",warn:"color: #FF9800",error:"color: #F44336",success:"color: #4CAF50"}[e],void 0!==r?r:"")}else{console["error"===e?"error":"warn"===e?"warn":"log"]("[".concat(e.toUpperCase(),"] ").concat(this.prefix," ").concat(t),void 0!==r?r:"")}},e}();function b(e){try{var t=window[e],r="__cache_shield_test__";return t.setItem(r,"test"),t.removeItem(r),!0}catch(e){return!1}}var w=function(){function e(e){void 0===e&&(e={}),this.config=this.mergeConfig(e),this.logger=new y(this.config.debug),this.capabilities={serviceWorker:"serviceWorker"in navigator,cacheAPI:"caches"in window,indexedDB:"indexedDB"in window,localStorage:b("localStorage"),sessionStorage:b("sessionStorage"),cookies:navigator.cookieEnabled,storageEstimate:"storage"in navigator&&"estimate"in navigator.storage,persistentStorage:"storage"in navigator&&"persist"in navigator.storage},this.browserCache=new d(this.config,this.logger),this.serviceWorker=new h(this.config,this.logger),this.storage=new f(this.config,this.logger),this.indexedDB=new g(this.config,this.logger),this.reloader=new p(this.logger),this.bfCache=new v(this.logger),this.config.preventBfCache&&this.bfCache.init(),this.logger.info("CacheShield initialized",{config:this.config,capabilities:this.capabilities})}return e.prototype.clear=function(e){return a(this,void 0,void 0,function(){var t,r,n,o,a,l,u,d,h,f,g,p,v,y,b,w,m,S,k,x,D,C,E,B,A,I,P,W,F=this;return s(this,function(s){switch(s.label){case 0:t=performance.now(),r=e?this.mergeConfig(i(i({},this.config),e)):this.config,n=this.resolveTargets(r.targets),this.logger.info("Starting cache clear",{targets:n}),s.label=1;case 1:return s.trys.push([1,3,,4]),[4,null===(C=(D=r.hooks).onBeforeClear)||void 0===C?void 0:C.call(D,n)];case 2:return s.sent(),[3,4];case 3:return o=s.sent(),this.logger.error("onBeforeClear hook failed",o),[3,4];case 4:a=[],l=n.length,u=0,d=n.includes("cacheAPI"),s.label=5;case 5:s.trys.push([5,13,14,15]),h=c(n),f=h.next(),s.label=6;case 6:if(f.done)return[3,12];g=f.value,s.label=7;case 7:return s.trys.push([7,9,,10]),[4,this.clearCacheType(g,{skipCacheClear:"serviceWorker"===g&&d})];case 8:return p=s.sent(),a.push(p),p.success?this.logger.success("Cleared ".concat(g),p):this.logger.warn("Failed to clear ".concat(g),p),[3,10];case 9:v=s.sent(),y=this.wrapError(v,g);try{null===(B=(E=r.hooks).onError)||void 0===B||B.call(E,y)}catch(e){this.logger.error("onError hook failed",e)}return a.push({type:g,success:!1,error:y.message}),[3,10];case 10:u++;try{null===(I=(A=r.hooks).onProgress)||void 0===I||I.call(A,{current:g,completed:u,total:l,percentage:Math.round(u/l*100)})}catch(e){this.logger.error("onProgress hook failed",e)}s.label=11;case 11:return f=h.next(),[3,6];case 12:return[3,15];case 13:return b=s.sent(),k={error:b},[3,15];case 14:try{f&&!f.done&&(x=h.return)&&x.call(h)}finally{if(k)throw k.error}return[7];case 15:w=performance.now()-t,m={success:a.every(function(e){return e.success}),cleared:a.filter(function(e){return e.success}),failed:a.filter(function(e){return!e.success}),timestamp:Date.now(),duration:w},this.logger.info("Cache clear completed",m),s.label=16;case 16:return s.trys.push([16,18,,19]),[4,null===(W=(P=r.hooks).onAfterClear)||void 0===W?void 0:W.call(P,m)];case 17:return s.sent(),[3,19];case 18:return S=s.sent(),this.logger.error("onAfterClear hook failed",S),[3,19];case 19:return r.autoReload&&m.success&&setTimeout(function(){F.reloader.reload(!0)},r.reloadDelay),[2,m]}})})},e.prototype.clearCacheType=function(e){return a(this,arguments,void 0,function(e,t){return void 0===t&&(t={}),s(this,function(r){switch(e){case"serviceWorker":return[2,this.serviceWorker.clear(t)];case"cacheAPI":return[2,this.browserCache.clearCacheAPI()];case"localStorage":return[2,this.storage.clearLocalStorage()];case"sessionStorage":return[2,this.storage.clearSessionStorage()];case"indexedDB":return[2,this.indexedDB.clear()];case"cookies":return[2,this.browserCache.clearCookies()];default:return[2,{type:e,success:!1,error:"Unknown cache type: ".concat(e)}]}})})},e.prototype.clearServiceWorkers=function(){return a(this,void 0,void 0,function(){return s(this,function(e){return[2,this.serviceWorker.clear()]})})},e.prototype.clearCacheAPI=function(){return a(this,void 0,void 0,function(){return s(this,function(e){return[2,this.browserCache.clearCacheAPI()]})})},e.prototype.clearLocalStorage=function(){return a(this,void 0,void 0,function(){return s(this,function(e){return[2,this.storage.clearLocalStorage()]})})},e.prototype.clearSessionStorage=function(){return a(this,void 0,void 0,function(){return s(this,function(e){return[2,this.storage.clearSessionStorage()]})})},e.prototype.clearIndexedDB=function(){return a(this,void 0,void 0,function(){return s(this,function(e){return[2,this.indexedDB.clear()]})})},e.prototype.clearCookies=function(){return a(this,void 0,void 0,function(){return s(this,function(e){return[2,this.browserCache.clearCookies()]})})},e.prototype.hardReload=function(){this.reloader.reload(!0)},e.prototype.clearAndReload=function(e){return a(this,void 0,void 0,function(){return s(this,function(t){switch(t.label){case 0:return[4,this.clear(e)];case 1:return t.sent(),this.hardReload(),[2]}})})},e.prototype.getStorageEstimate=function(){return a(this,void 0,void 0,function(){return s(this,function(e){return"storage"in navigator&&"estimate"in navigator.storage?[2,navigator.storage.estimate()]:[2,null]})})},e.prototype.getCapabilities=function(){return this.capabilities},e.prototype.resolveTargets=function(e){var t=this;if(e.includes("all")){return["serviceWorker","cacheAPI","localStorage","sessionStorage","indexedDB","cookies"].filter(function(e){switch(e){case"serviceWorker":return t.capabilities.serviceWorker;case"cacheAPI":return t.capabilities.cacheAPI;case"indexedDB":return t.capabilities.indexedDB;default:return!0}})}return e},e.prototype.mergeConfig=function(t){return i(i(i({},e.DEFAULTS),t),{cookies:i(i({},e.DEFAULTS.cookies),t.cookies),indexedDB:i(i({},e.DEFAULTS.indexedDB),t.indexedDB),storage:i(i({},e.DEFAULTS.storage),t.storage),hooks:i(i({},e.DEFAULTS.hooks),t.hooks)})},e.prototype.wrapError=function(e,t){if(e instanceof u)return e;var r=e instanceof Error?e:new Error(String(e));return new u("Failed to clear ".concat(t,": ").concat(r.message),"UNKNOWN",t,r)},e.DEFAULTS={targets:["all"],include:[],exclude:[],cookies:{preserveEssential:!0,essentialCookies:["csrf","session","auth"]},indexedDB:{deleteDatabase:!0},storage:{preserveKeys:[]},debug:!1,hooks:{},autoReload:!1,reloadDelay:100,preventBfCache:!1},e}(),m=Symbol("CacheShield");function S(n){var o=new w(n),i=e(!1),c=e(null),l=t(o.getCapabilities());function u(e){return a(this,void 0,void 0,function(){var t;return s(this,function(r){switch(r.label){case 0:i.value=!0,r.label=1;case 1:return r.trys.push([1,,3,4]),[4,o.clear(e)];case 2:return t=r.sent(),c.value=t,[2,t];case 3:return i.value=!1,[7];case 4:return[2]}})})}function d(){o.hardReload()}return{shield:o,isClearing:r(i),lastResult:r(c),capabilities:r(l),clear:u,clearType:function(e){return a(this,void 0,void 0,function(){return s(this,function(t){switch(t.label){case 0:i.value=!0,t.label=1;case 1:switch(t.trys.push([1,,15,16]),e){case"serviceWorker":return[3,2];case"localStorage":return[3,4];case"sessionStorage":return[3,6];case"indexedDB":return[3,8];case"cookies":return[3,10];case"cacheAPI":return[3,12]}return[3,14];case 2:return[4,o.clearServiceWorkers()];case 3:return t.sent(),[3,14];case 4:return[4,o.clearLocalStorage()];case 5:return t.sent(),[3,14];case 6:return[4,o.clearSessionStorage()];case 7:return t.sent(),[3,14];case 8:return[4,o.clearIndexedDB()];case 9:return t.sent(),[3,14];case 10:return[4,o.clearCookies()];case 11:return t.sent(),[3,14];case 12:return[4,o.clearCacheAPI()];case 13:return t.sent(),[3,14];case 14:return[3,16];case 15:return i.value=!1,[7];case 16:return[2]}})})},hardReload:d,clearAndReload:function(e){return a(this,void 0,void 0,function(){return s(this,function(t){switch(t.label){case 0:return[4,u(e)];case 1:return t.sent(),d(),[2]}})})}}}function k(e,t){var r=S(t);e.provide(m,r),e.config.globalProperties.$cacheShield=r}function x(){var e=n(m);if(!e)throw new Error("CacheShield not found. Did you install the CacheShieldPlugin?");return e}function D(e){return S(e)}export{m as CacheShieldKey,k as CacheShieldPlugin,S as createCacheShield,k as default,x as useCacheShield,D as useCacheShieldSimple};
